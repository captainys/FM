ALL : BUILD EXE DISKIMG BUILD\LAYOUT.EXP BUILD\CUTOUT.EXP TOWNSOS\ICMWRITE.EXP TOWNSOS\ICMIMAGE.C EXE\TESTFONT.EXE BUILD\LOADER.BIN BUILD\ICM_IPLM.BIN BUILD\HD_IPL0.BIN BUILD\HD_IPL.BIN BUILD\CD_IPL.BIN BUILD\FD_IPL.BIN BUILD\FD_IPLM.BIN DISKIMG\ICMIMAGE.BIN DISKIMG\HDIMAGE.BIN DISKIMG\FDIMAGE.BIN DISKIMG\FDMINI.BIN DISKIMG\FDIMAGEM.BIN DISKIMG\FDMINIM.BIN DISKIMG\CDIMAGE.ISO BUILD\TESTIPL.BIN EXE\TESTFD.BIN EXE\TESTHD.BIN



BUILD:
	MD BUILD

EXE:
	MD EXE

DISKIMG:
	MD DISKIMG




BUILD\LAYOUT.OBJ : LAYOUT.C
	HCD386 LAYOUT.C -OBJ BUILD\LAYOUT.OBJ

BUILD\LAYOUT.EXP : BUILD\LAYOUT.OBJ
	386LINK BUILD\LAYOUT.OBJ -LIB C:\hc386\small\hce.lib C:\hc386\small\na.lib -EXE BUILD\LAYOUT.EXP



BUILD\CUTOUT.OBJ : CUTOUT.C
	HCD386 CUTOUT.C -OBJ BUILD\CUTOUT.OBJ

BUILD\CUTOUT.EXP : BUILD\CUTOUT.OBJ
	386LINK BUILD\CUTOUT.OBJ -LIB C:\hc386\small\hce.lib C:\hc386\small\na.lib -EXE BUILD\CUTOUT.EXP



BUILD\TESTFONT.OBJ : TESTFONT.ASM IODEF.ASM DRAWFONT.ASM MEMBANK.ASM
	MASM TESTFONT.ASM BUILD\TESTFONT.OBJ BUILD\TESTFONT.LST NUL

EXE\TESTFONT.EXE : BUILD\TESTFONT.OBJ
	LINK BUILD\TESTFONT.OBJ;
	COPY TESTFONT.EXE EXE\.
	DEL TESTFONT.EXE



BUILD\LOADER.OBJ : LOADER.ASM LOADYSSC.ASM CDBOOT.ASM IODEF.ASM DEF.ASM DRAWFONT.ASM MEMBANK.ASM ..\SCSILIB\SCSIIO.ASM SCSIUTIL.ASM UTIL.ASM ..\RESOURCE\AOMORI.ASM UI.ASM HID_IO.ASM CRTC.ASM MAINMENU.ASM BOOTMENU.ASM INTRCEPT.ASM PATCH.ASM CMOSMENU.ASM RS232MNU.ASM CMOSRST.ASM IPLDMENU.ASM VRAM.ASM BUFFERS.ASM ..\RS232C\RS232C.ASM ..\RS232C\XMODEM.ASM ..\MISCLIB\SERIAL.ASM ..\MISCLIB\RDHIGH.ASM ..\MISCLIB\GDT.ASM
	MASM LOADER.ASM BUILD\LOADER.OBJ BUILD\LOADER.LST NUL > BUILD\OUTPUT.TXT

BUILD\LOADER.BIN : BUILD\LOADER.OBJ
	LINK BUILD\LOADER.OBJ;
	EXE2BIN LOADER.EXE BUILD\LOADER.BIN
	DEL LOADER.EXE



BUILD\HD_IPL0.OBJ : HD_IPL0.ASM IODEF.ASM DEF.ASM DRAWFONT.ASM MEMBANK.ASM
	MASM HD_IPL0.ASM BUILD\HD_IPL0.OBJ BUILD\HD_IPL0.LST NUL

BUILD\HD_IPL0.BIN : BUILD\HD_IPL0.OBJ
	LINK BUILD\HD_IPL0.OBJ;
	EXE2BIN HD_IPL0.EXE BUILD\HD_IPL0.BIN
	DEL HD_IPL0.EXE



BUILD\HD_IPL.OBJ : HD_IPL.ASM IODEF.ASM DEF.ASM DRAWFONT.ASM MEMBANK.ASM
	MASM HD_IPL.ASM BUILD\HD_IPL.OBJ BUILD\HD_IPL.LST NUL

BUILD\HD_IPL.BIN : BUILD\HD_IPL.OBJ
	LINK BUILD\HD_IPL.OBJ;
	EXE2BIN HD_IPL.EXE BUILD\HD_IPL.BIN
	DEL HD_IPL.EXE



BUILD\CD_IPL.OBJ : CD_IPL.ASM IODEF.ASM DEF.ASM DRAWFONT.ASM MEMBANK.ASM ..\SCSILIB\SCSIIO.ASM
	MASM CD_IPL.ASM BUILD\CD_IPL.OBJ BUILD\CD_IPL.LST NUL

BUILD\CD_IPL.BIN : BUILD\CD_IPL.OBJ
	LINK BUILD\CD_IPL.OBJ;
	EXE2BIN CD_IPL.EXE BUILD\CD_IPL.BIN
	DEL CD_IPL.EXE



BUILD\FD_IPL.OBJ : FD_IPL.ASM FDIPLBAS.ASM IODEF.ASM DEF.ASM DRAWFONT.ASM MEMBANK.ASM
	MASM FD_IPL.ASM BUILD\FD_IPL.OBJ BUILD\FD_IPL.LST NUL

BUILD\FD_IPL.BIN : BUILD\FD_IPL.OBJ
	LINK BUILD\FD_IPL.OBJ;
	EXE2BIN FD_IPL.EXE BUILD\FD_IPL.BIN
	DEL FD_IPL.EXE



BUILD\FD_IPLM.OBJ : FD_IPLM.ASM FDIPLBAS.ASM IODEF.ASM DEF.ASM DRAWFONT.ASM MEMBANK.ASM
	MASM FD_IPLM.ASM BUILD\FD_IPLM.OBJ BUILD\FD_IPLM.LST NUL

BUILD\FD_IPLM.BIN : BUILD\FD_IPLM.OBJ
	LINK BUILD\FD_IPLM.OBJ;
	EXE2BIN FD_IPLM.EXE BUILD\FD_IPLM.BIN
	DEL FD_IPLM.EXE



BUILD\ICM_IPLM.OBJ : ICM_IPLM.ASM FDIPLBAS.ASM IODEF.ASM DEF.ASM DRAWFONT.ASM MEMBANK.ASM
	MASM ICM_IPLM.ASM BUILD\ICM_IPLM.OBJ BUILD\ICM_IPLM.LST NUL

BUILD\ICM_IPLM.BIN : BUILD\ICM_IPLM.OBJ
	LINK BUILD\ICM_IPLM.OBJ;
	EXE2BIN ICM_IPLM.EXE BUILD\ICM_IPLM.BIN
	DEL ICM_IPLM.EXE



DISKIMG\HDIMAGE.BIN : BUILD\HD_IPL0.BIN BUILD\HD_IPL.BIN BUILD\LOADER.BIN ..\YSSCSICD\SYS\YSSCSICD.SYS
	RUN386 BUILD\LAYOUT.EXP DISKIMG\HDIMAGE.BIN 1025 BUILD\HD_IPL0.BIN 0 HD_PTAB.BIN 512 HD_0108.BIN 1040
	RUN386 BUILD\LAYOUT.EXP DISKIMG\HDIMAGE.BIN OVERWRITE BUILD\HD_IPL.BIN 1536 HD_F9FF.BIN 2048
	RUN386 BUILD\LAYOUT.EXP DISKIMG\HDIMAGE.BIN OVERWRITE HD_FAT.BIN 2560 HD_FAT.BIN 5632
	RUN386 BUILD\LAYOUT.EXP DISKIMG\HDIMAGE.BIN OVERWRITE BUILD\LOADER.BIN 16896
	RUN386 BUILD\LAYOUT.EXP DISKIMG\HDIMAGE.BIN OVERWRITE ..\YSSCSICD\SYS\YSSCSICD.SYS 82432


DISKIMG\ICMIMAGE.BIN : BUILD\ICM_IPLM.BIN BUILD\LOADER.BIN ..\YSSCSICD\SYS\YSSCSICD.SYS
	RUN386 BUILD\LAYOUT.EXP DISKIMG\ICMIMAGE.BIN 32 BUILD\ICM_IPLM.BIN 0 BUILD\LOADER.BIN 1024 ..\YSSCSICD\SYS\YSSCSICD.SYS 24576


DISKIMG\FDIMAGE.BIN : BUILD\FD_IPL.BIN BUILD\LOADER.BIN ..\YSSCSICD\SYS\YSSCSICD.SYS
	RUN386 BUILD\LAYOUT.EXP DISKIMG\FDIMAGE.BIN 1232 FDFAT.BIN 1024 FDFAT.BIN 3072 FDDIR.BIN 5120
	RUN386 BUILD\LAYOUT.EXP DISKIMG\FDIMAGE.BIN OVERWRITE BUILD\FD_IPL.BIN 0 BUILD\LOADER.BIN 11264 ..\YSSCSICD\SYS\YSSCSICD.SYS 65536

DISKIMG\FDMINI.BIN : DISKIMG\FDIMAGE.BIN
	RUN386 BUILD\CUTOUT.EXP DISKIMG\FDIMAGE.BIN 0 163840 DISKIMG\FDMINI.BIN


# Command line lenght is limited to 136 apparently.

DISKIMG\FDIMAGEM.BIN : BUILD\FD_IPLM.BIN BUILD\LOADER.BIN ..\YSSCSICD\SYS\YSSCSICD.SYS
	RUN386 BUILD\LAYOUT.EXP DISKIMG\FDIMAGEM.BIN 1232 FDFAT.BIN 1024 FDFAT.BIN 3072 FDDIR.BIN 5120
	RUN386 BUILD\LAYOUT.EXP DISKIMG\FDIMAGEM.BIN OVERWRITE BUILD\FD_IPLM.BIN 0
	RUN386 BUILD\LAYOUT.EXP DISKIMG\FDIMAGEM.BIN OVERWRITE BUILD\LOADER.BIN 11264 ..\YSSCSICD\SYS\YSSCSICD.SYS 65536

DISKIMG\FDMINIM.BIN : DISKIMG\FDIMAGEM.BIN
	RUN386 BUILD\CUTOUT.EXP DISKIMG\FDIMAGEM.BIN 0 163840 DISKIMG\FDMINIM.BIN



DISKIMG\CDIMAGE.ISO : BUILD\CD_IPL.BIN BUILD\LOADER.BIN ..\YSSCSICD\SYS\YSSCSICD.SYS
	RUN386 BUILD\LAYOUT.EXP DISKIMG\CDIMAGE.ISO 160 BUILD\CD_IPL.BIN 0 BUILD\LOADER.BIN 8192 ..\YSSCSICD\SYS\YSSCSICD.SYS 65536



BUILD\TESTIPL.OBJ : TESTIPL.ASM IODEF.ASM DRAWFONT.ASM MEMBANK.ASM
	MASM TESTIPL.ASM BUILD\TESTIPL.OBJ BUILD\TESTIPL.LST NUL

BUILD\TESTIPL.BIN : BUILD\TESTIPL.OBJ
	LINK BUILD\TESTIPL.OBJ;
	EXE2BIN TESTIPL.EXE BUILD\TESTIPL.BIN
	DEL TESTIPL.EXE

EXE\TESTFD.BIN : BUILD\TESTIPL.BIN
	RUN386 BUILD\LAYOUT.EXP EXE\TESTFD.BIN 1232 BUILD\TESTIPL.BIN 0

EXE\TESTHD.BIN : BUILD\TESTIPL.BIN
	RUN386 BUILD\LAYOUT.EXP EXE\TESTHD.BIN 1232 BUILD\TESTIPL.BIN 0



TOWNSOS\ICMWRITE.EXP : BUILD\ICMWRITE.OBJ BUILD\ICMIMAGE.OBJ
	TLINK.EXE BUILD\ICMWRITE.OBJ BUILD\ICMIMAGE.OBJ @TOWNSOS\ICMWRITE.LN -EXE TOWNSOS\ICMWRITE.EXP

BUILD\BIN2C.EXP : BIN2C.C
	HCD386 BIN2C.C -obj BUILD\BIN2C.OBJ
	TLINK BUILD\BIN2C.OBJ -LIB C:\HC386\SMALL\HCE -STACK 102400 -EXE BUILD\BIN2C.EXP

TOWNSOS\ICMIMAGE.C : BUILD\BIN2C.EXP DISKIMG\ICMIMAGE.BIN
	RUN386 BUILD\BIN2C.EXP DISKIMG\ICMIMAGE.BIN TOWNSOS\ICMIMAGE ICMIMAGE

BUILD\ICMWRITE.OBJ : TOWNSOS\ICMWRITE.C
	HCD386 TOWNSOS\ICMWRITE.C -obj BUILD\ICMWRITE.OBJ

BUILD\ICMIMAGE.OBJ : TOWNSOS\ICMIMAGE.C TOWNSOS\ICMIMAGE.H
	RUN386 C:\HC386\BIN\HCD386P TOWNSOS\ICMIMAGE.C -obj BUILD\ICMIMAGE.OBJ
